# Google Pay - payment data cryptography in C#

## Overview

.NET idiomatic library that performs the steps outlined in [Payment data cryptography](https://developers.google.com/pay/api/web/guides/resources/payment-data-cryptography).
It allows you to decrypt and verify a `PaymentMethodToken` object generated by
the Google Pay API. It supports versions `ECv1` and `ECv2`.

Internally, it relies on [Bouncy Castle C#](https://www.bouncycastle.org/csharp/index.html)
and has no other external dependencies.

## Sample use

### Decrypt payment messages
```csharp
// To use INSTANCE_TEST, set the parameter to true
var keyProvider = new GooglePay.PaymentDataCryptography.GoogleKeyProvider(false);
var parser = new GooglePay.PaymentDataCryptography.PaymentMethodTokenRecipient("merchant:YOUR_MERCHANT_ID", keyProvider);
parser.AddPrivateKey(PrivateKey1);
parser.AddPrivateKey(PrivateKey2);
string decryptedMessage = parser.Unseal(encryptedMessage);
```

### Validate Pass callbacks
```csharp
var passCallbackValidator = new PassCallbackValidator();
var innerMessage = passCallbackValidator.Verify("YOUR_ISSUER_ID", receivedCallbackMessage);
```

### Custom HTTP configuration

`GoogleKeyProviderOptions` allows customization of the HTTP client used to fetch
Google's signing keys. This is useful for custom certificate validation, logging,
proxies, or any other `HttpMessageHandler`-based configuration.

```csharp
using GooglePay.PaymentDataCryptography;

// Configure a custom handler (e.g. certificate validation + logging)
var handler = new HttpClientHandler
{
    ServerCertificateCustomValidationCallback = (message, cert, chain, errors) =>
    {
        // Custom certificate validation logic
        return true;
    }
};
var loggingHandler = new MyLoggingHandler(handler); // DelegatingHandler

var options = new GoogleKeyProviderOptions
{
    MessageHandler = loggingHandler,
    CacheDuration = TimeSpan.FromHours(1), // Override default 7-day / server-controlled cache
};

// Use with GoogleKeyProvider
var keyProvider = new GoogleKeyProvider(options);
var parser = new PaymentMethodTokenRecipient("merchant:YOUR_MERCHANT_ID", keyProvider);

// Use with PassCallbackValidator (URL/IsTest are ignored â€” always uses Google Passes endpoint)
var validator = new PassCallbackValidator(options);
```

#### GoogleKeyProviderOptions

| Property | Type | Default | Description |
|----------|------|---------|-------------|
| `IsTest` | `bool` | `false` | Use Google's test key endpoint instead of production |
| `Url` | `string` | `null` | Custom key endpoint URL (overrides `IsTest`) |
| `CacheDuration` | `TimeSpan?` | `null` | Fixed cache TTL (when null, uses server `Cache-Control` max-age or 7 days) |
| `MessageHandler` | `HttpMessageHandler` | `null` | Custom handler for the underlying `HttpClient` (not disposed by the provider) |

## Disclaimer

This is not an official Google product.

[Tink](https://github.com/google/tink) is the library actively maintained and
supported by the Google Pay team. Using Tink to perform payment data
cryptography for Google Pay is highly recommended.
